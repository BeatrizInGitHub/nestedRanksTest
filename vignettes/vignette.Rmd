---
title: "Using nestedRanksTest"
author: "Douglas G. Scofield"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using nestedRanksTest}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

# Motivation for developing the test

Together with my colleagues Pamela Thompson, Peter Smouse and Victoria Sork, we
were examining year-to-year differences in acorn movement by acorn woodpeckers
in an oak savannah in central California.  Drs. Sork and Smouse have
collaborated for several years studying patterns of genetic diversity in oak
populations, unraveling the ways in which genetic diversity moves around the
landscape via dispersal of pollen and seeds, and developing analytic methods to
study these topics and help others do so as well.  I did a post-doc in Dr.
Sork's lab, publishing several papers together.  We continued to develop
methods for characterising dispersal in plant populations.  All the methods I
was involved in developing have been described and used in our published
research, and all have been implemented in R.  Source code for these
methods was always available via Dr. Sork's lab website and later via my own
collection of [Github repositories](https://github.com/douglasgscofield), but it has been only recently that I have begun releasing this code via R packages.

Acorn woodpeckers are highly social,
and each social group maintains its own granary in which it stores acorns.  The
woodpeckers are highly territorial and occupy relatively stable territories,
each containing a number of mature oak trees at varying distances from the
granary.  Because each granary has its own neighbourhood of oak trees, it would
not be a very precise test to look for overall differences in acorn movement
within the entire savannah, on the other hand looking for differences within
each granary individually would have required greater than practical sample
sizes to have sufficient statistical power.  We chose instead to test whether
the distance ranks differ between years within each granary, and combine
results across granaries for an aggregate between-year test.


We first described this test in [Thompson _et al._ 2014 _Movement Ecology_
2:12](http://www.movementecologyjournal.com/content/2/1/12).

What was our motivation for why we expected the years to be different?

Table with the data counts:

```{r}
data(woodpecker_multiyear)
d.Qagrifolia <- subset(woodpecker_multiyear, Species == "agrifolia")
d.Qlobata <- subset(woodpecker_multiyear, Species == "lobata")
table(d.Qagrifolia$Year, d.Qagrifolia$Granary)
table(d.Qagrifolia$Year, d.Qagrifolia$Granary)
```

Because each granary has its own neighbourhood of oak trees varying in
distance:

```{r}
cat("Mean distance (m) between granaries and Q. agrifolia seed trees\n")
with(d.Qagrifolia, unlist(lapply(split(Distance, Granary), mean)))
cat("Mean distance (m) between granaries and Q. lobata seed trees\n")
with(d.Qlobata, unlist(lapply(split(Distance, Granary), mean)))
# put in a dotplot for each Quercus with granary along bottom and jittered
# distance to seed source tree above
```

it is not be a very precise test to look for overall differences in acorn
movement within the entire savannah.

```{r}
wilcox.test(Distance ~ Year, data = d.Qagrifolia)
wilcox.test(Distance ~ Year, data = d.Qlobata)
```

On the other hand, looking for differences within each granary individually
would have required greater sample sizes than is practical.  The woodpeckers
collect hundreds and thousands of acorns each year (Walt's book) but we can't!

```{r}
# R code to split d.Qagrifolia by granary and perform the test between year
# for each granary
wilcox.test(Distance ~ Year, data = d.Qagrifolia)
wilcox.test(Distance ~ Year, data = d.Qlobata)
```

The situation is a bit frustrating, because we can visually see that there are
year-to-year differences in the distances woodpeckers moved seeds.

```{r}
# put in a dotplot for each Quercus with granary along bottom and jittered
# distance to seed source tree above, with each dot coloured by year
```

We chose instead to test whether the distance ranks differ between years within
each granary, and combine results across granaries for an aggregate
between-year test.



Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` setion of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
